{
  "project": "B2B API",
  "version": "1.0.0",
  "repository": "b2b-api",
  "methodology": "hybrid-lisa-ralph",
  "created": "2026-02-06",
  "phases": [
    {
      "id": "phase-0",
      "name": "Foundation & Testing Infrastructure",
      "weight": "70% Lisa / 30% Ralph",
      "items": [
        {
          "id": "PRD-000",
          "title": "NestJS Project Scaffold",
          "module": "foundation",
          "priority": "P0",
          "completion_criteria": [
            "Initialize npm project with package.json (name: b2b-api, version: 1.0.0)",
            "Install NestJS 10+ with dependencies: @nestjs/core, @nestjs/common, @nestjs/platform-express, reflect-metadata, rxjs",
            "Install dev dependencies: typescript, @types/node, ts-node, @nestjs/cli, @nestjs/schematics",
            "Create tsconfig.json with strict mode, paths aliases (@common/*, @core/*, @business/*, @platform/*, @agentic/*)",
            "Create tsconfig.build.json for production builds",
            "Create nest-cli.json with sourceRoot and compilerOptions",
            "Create .eslintrc.js with @typescript-eslint, NestJS recommended rules",
            "Create .prettierrc with singleQuote: true, trailingComma: all, printWidth: 100",
            "Create .prettierignore and .eslintignore",
            "Create .gitignore for node_modules, dist, coverage, .env, etc.",
            "Create .husky/ with pre-commit hook running lint-staged",
            "Create .env.example with DATABASE_URL, REDIS_URL, JWT_SECRET, etc.",
            "Create directory structure: src/{common,core,business,platform,agentic,infrastructure}",
            "Create src/main.ts with NestFactory bootstrap, helmet (CSP disabled in dev), Swagger at /docs, root redirect to /docs",
            "Create src/app.module.ts as root module",
            "Add npm scripts: start, start:dev, start:debug, start:prod, build, lint, format, typecheck",
            "npm run start:dev works",
            "npm run build works"
          ],
          "dependencies": [],
          "max_iterations": 8,
          "status": "pending"
        },
        {
          "id": "PRD-001",
          "title": "Unit Testing Infrastructure",
          "module": "foundation/testing",
          "priority": "P0",
          "completion_criteria": [
            "Install jest, ts-jest, @types/jest as dev dependencies",
            "Create jest.config.js with ts-jest preset, moduleNameMapper for path aliases",
            "Configure coverage thresholds: 80% for branches, functions, lines, statements",
            "Configure collectCoverageFrom to include src/**/*.ts, exclude *.module.ts, main.ts",
            "Create src/common/testing/test-utils.ts with mock helpers",
            "Create src/common/testing/index.ts barrel export",
            "Add npm scripts: test, test:watch, test:cov, test:debug",
            "npm run test works (runs Jest)",
            "npm run test:cov generates HTML coverage report in coverage/"
          ],
          "dependencies": [
            "PRD-000"
          ],
          "max_iterations": 5,
          "status": "pending"
        },
        {
          "id": "PRD-002",
          "title": "Integration Testing Infrastructure",
          "module": "foundation/testing",
          "priority": "P0",
          "completion_criteria": [
            "Install testcontainers, @testcontainers/postgresql as dev dependencies",
            "Create test/integration/ directory structure",
            "Create test/integration/jest.integration.config.js extending base jest.config",
            "Create test/integration/setup-global.ts for container startup",
            "Create test/integration/setup-after-env.ts for Prisma client and factories",
            "Create test/factories/tenant.factory.ts with create, createMany methods",
            "Create test/factories/user.factory.ts with create, createMany methods",
            "Create test/factories/index.ts barrel export",
            "Create .testcontainers.properties with ryuk.disabled=true for CI",
            "Database truncated between each test via beforeEach hook",
            "Add npm script: test:integration pointing to integration config",
            "npm run test:integration works with real PostgreSQL container"
          ],
          "dependencies": [
            "PRD-001",
            "PRD-004"
          ],
          "max_iterations": 8,
          "status": "pending"
        },
        {
          "id": "PRD-003",
          "title": "E2E Testing Infrastructure",
          "module": "foundation/testing",
          "priority": "P0",
          "completion_criteria": [
            "Supertest configured",
            "npm run test:e2e works",
            "Auth helper for test tokens",
            "npm run test:all runs all tests"
          ],
          "dependencies": [
            "PRD-002"
          ],
          "max_iterations": 8,
          "status": "pending"
        },
        {
          "id": "PRD-004",
          "title": "Database Setup with Prisma",
          "module": "infrastructure/database",
          "priority": "P0",
          "completion_criteria": [
            "Install prisma, @prisma/client as dependencies",
            "Create prisma/schema.prisma with PostgreSQL datasource",
            "Configure DATABASE_URL from environment variable",
            "Create Tenant model: id (cuid), name, slug (unique), config (Json), createdAt, updatedAt",
            "Create User model: id, email (unique per tenant), passwordHash, firstName, lastName, role, tenantId (FK), createdAt, updatedAt",
            "Add tenantId field to User with relation to Tenant",
            "Create prisma/seed.ts that creates default tenant and admin user",
            "Seed script reads master catalog from .claude/planning/data/cleaned_products.json if exists",
            "Add npm scripts: prisma:generate, prisma:migrate, prisma:studio, prisma:seed",
            "npm run prisma:generate creates Prisma client",
            "npm run prisma:migrate creates migration and applies to database",
            "npm run prisma:seed populates initial data"
          ],
          "dependencies": [
            "PRD-000"
          ],
          "max_iterations": 6,
          "status": "pending"
        },
        {
          "id": "PRD-005",
          "title": "Docker Compose - Core",
          "module": "infrastructure",
          "priority": "P0",
          "completion_criteria": [
            "Create docker/ directory",
            "Create docker/docker-compose.yml with version 3.8",
            "PostgreSQL 15 service: image postgres:15-alpine, port 5432, volume pgdata, env POSTGRES_USER/PASSWORD/DB",
            "Redis 7 service: image redis:7-alpine, port 6379, volume redisdata, command with appendonly",
            "MinIO service: image minio/minio, ports 9000 (API) and 9001 (console), volume miniodata, command server /data --console-address :9001",
            "Elasticsearch 8 service: image elasticsearch:8.11.0, port 9200, volume esdata, env discovery.type=single-node, xpack.security.enabled=false",
            "Health checks on all services with proper intervals and timeouts",
            "Named volumes: pgdata, redisdata, miniodata, esdata",
            "Network: b2b-network (bridge driver)",
            "docker-compose -f docker/docker-compose.yml up -d starts all services",
            "All services healthy within 60 seconds"
          ],
          "dependencies": [
            "PRD-000"
          ],
          "max_iterations": 6,
          "status": "pending"
        },
        {
          "id": "PRD-006",
          "title": "Docker Compose - Workflow & Auth",
          "module": "infrastructure",
          "priority": "P0",
          "completion_criteria": [
            "Add to docker/docker-compose.yml or create docker/docker-compose.override.yml",
            "Temporal PostgreSQL: separate postgres instance for temporal, port 5433, volume temporal_pgdata",
            "Temporal server: image temporalio/auto-setup:1.22, port 7233 (gRPC), depends on temporal postgres",
            "Temporal UI: image temporalio/ui:2.21, port 8080, env TEMPORAL_ADDRESS=temporal:7233",
            "Keycloak PostgreSQL: separate postgres instance, port 5434, volume keycloak_pgdata",
            "Keycloak: image quay.io/keycloak/keycloak:23.0, port 8180, command start-dev, env KC_DB, KC_DB_URL, KEYCLOAK_ADMIN/PASSWORD",
            "Health checks on Temporal and Keycloak services",
            "All services on b2b-network",
            "Temporal UI accessible at http://localhost:8080",
            "Keycloak admin console accessible at http://localhost:8180"
          ],
          "dependencies": [
            "PRD-005"
          ],
          "max_iterations": 8,
          "status": "pending"
        },
        {
          "id": "PRD-007",
          "title": "Docker Compose - Observability",
          "module": "infrastructure",
          "priority": "P1",
          "completion_criteria": [
            "Create docker/docker-compose.observability.yml as optional overlay",
            "Prometheus: image prom/prometheus:v2.47.0, port 9090, volume for config and data",
            "Create docker/prometheus/prometheus.yml with scrape configs for API metrics",
            "Grafana: image grafana/grafana:10.2.0, port 3001, volume grafanadata, env GF_SECURITY_ADMIN_PASSWORD",
            "Jaeger: image jaegertracing/all-in-one:1.51, ports 16686 (UI), 6831 (UDP), 14268 (HTTP)",
            "All services on b2b-network",
            "docker-compose -f docker/docker-compose.yml -f docker/docker-compose.observability.yml up -d works",
            "Grafana accessible at http://localhost:3001",
            "Jaeger UI accessible at http://localhost:16686"
          ],
          "dependencies": [
            "PRD-005"
          ],
          "max_iterations": 6,
          "status": "pending"
        },
        {
          "id": "PRD-008",
          "title": "CI Pipeline",
          "module": "infrastructure/ci",
          "priority": "P1",
          "completion_criteria": [
            "Create .github/workflows/ directory",
            "Create .github/workflows/ci.yml triggered on push and pull_request",
            "Use ubuntu-latest runner with Node.js 20",
            "Job 1 - Lint: npm ci, npm run lint, npm run typecheck",
            "Job 2 - Test: npm ci, npm run test:cov, upload coverage artifact",
            "Job 3 - Build: npm ci, npm run build, upload dist artifact",
            "Cache node_modules using actions/cache",
            "PostgreSQL service container for integration tests",
            "Set DATABASE_URL environment variable for tests",
            "All jobs run in parallel where possible",
            "Pipeline passes on clean codebase"
          ],
          "dependencies": [
            "PRD-003"
          ],
          "max_iterations": 5,
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-1",
      "name": "Core Infrastructure",
      "weight": "50% Lisa / 50% Ralph",
      "items": [
        {
          "id": "PRD-009",
          "title": "Multi-Tenancy Middleware",
          "module": "core/tenants",
          "priority": "P0",
          "completion_criteria": [
            "TenantMiddleware extracts tenantId",
            "@TenantContext() decorator",
            "Unit tests: >90% coverage"
          ],
          "dependencies": [
            "PRD-004"
          ],
          "max_iterations": 8,
          "status": "pending"
        },
        {
          "id": "PRD-010",
          "title": "PostgreSQL RLS",
          "module": "core/tenants",
          "priority": "P0",
          "completion_criteria": [
            "RLS policies on tenant-scoped tables",
            "Integration tests: cross-tenant blocked"
          ],
          "dependencies": [
            "PRD-009"
          ],
          "max_iterations": 10,
          "status": "pending"
        },
        {
          "id": "PRD-011",
          "title": "Auth - Registration & Login",
          "module": "core/auth",
          "priority": "P0",
          "completion_criteria": [
            "POST /auth/register",
            "POST /auth/login returns tokens",
            "E2E: register -> login -> protected"
          ],
          "dependencies": [
            "PRD-009"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-012",
          "title": "Auth - Refresh & Logout",
          "module": "core/auth",
          "priority": "P0",
          "completion_criteria": [
            "POST /auth/refresh with rotation",
            "POST /auth/logout"
          ],
          "dependencies": [
            "PRD-011"
          ],
          "max_iterations": 8,
          "status": "pending"
        },
        {
          "id": "PRD-013",
          "title": "Authorization (CASL)",
          "module": "core/auth",
          "priority": "P0",
          "completion_criteria": [
            "CASL with role definitions",
            "AuthorizationGuard",
            "@CheckAbility() decorator"
          ],
          "dependencies": [
            "PRD-011"
          ],
          "max_iterations": 10,
          "status": "pending"
        },
        {
          "id": "PRD-014",
          "title": "Audit Logging",
          "module": "core/audit",
          "priority": "P0",
          "completion_criteria": [
            "AuditLog table",
            "@AuditLog() decorator",
            "GET /audit with filters"
          ],
          "dependencies": [
            "PRD-011"
          ],
          "max_iterations": 10,
          "status": "pending"
        },
        {
          "id": "PRD-015",
          "title": "Error Handling & Logging",
          "module": "common",
          "priority": "P0",
          "completion_criteria": [
            "GlobalExceptionFilter",
            "Pino structured logging",
            "Correlation ID"
          ],
          "dependencies": [
            "PRD-000"
          ],
          "max_iterations": 6,
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Core Modules",
      "weight": "30% Lisa / 70% Ralph",
      "items": [
        {
          "id": "PRD-016",
          "title": "Tenants Module",
          "module": "core/tenants",
          "priority": "P1",
          "completion_criteria": [
            "CRUD endpoints (super_admin)",
            "TenantConfig JSONB",
            "Soft delete"
          ],
          "dependencies": [
            "PRD-013"
          ],
          "max_iterations": 8,
          "status": "pending"
        },
        {
          "id": "PRD-017",
          "title": "Organizations Module",
          "module": "core/organizations",
          "priority": "P1",
          "completion_criteria": [
            "CRUD with hierarchy",
            "GET /:id/hierarchy tree"
          ],
          "dependencies": [
            "PRD-016"
          ],
          "max_iterations": 8,
          "status": "pending"
        },
        {
          "id": "PRD-018",
          "title": "Users Module",
          "module": "core/users",
          "priority": "P1",
          "completion_criteria": [
            "CRUD endpoints",
            "GET /me, PATCH /me",
            "Password change"
          ],
          "dependencies": [
            "PRD-017"
          ],
          "max_iterations": 10,
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "Business Modules",
      "weight": "40% Lisa / 60% Ralph",
      "items": [
        {
          "id": "PRD-019",
          "title": "Contracts - CRUD",
          "module": "business/contracts",
          "priority": "P1",
          "completion_criteria": [
            "Contract entity with versioning",
            "CRUD endpoints",
            "Version history"
          ],
          "dependencies": [
            "PRD-018"
          ],
          "max_iterations": 10,
          "status": "pending"
        },
        {
          "id": "PRD-020",
          "title": "Contracts - Workflow",
          "module": "business/contracts",
          "priority": "P1",
          "completion_criteria": [
            "Submit, approve, reject, activate",
            "State machine",
            "Audit on transitions"
          ],
          "dependencies": [
            "PRD-019",
            "PRD-014"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-021",
          "title": "Quotes Module",
          "module": "business/quotes",
          "priority": "P1",
          "completion_criteria": [
            "CRUD with line items",
            "Workflow with thresholds",
            "Convert to contract"
          ],
          "dependencies": [
            "PRD-019"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-022",
          "title": "Master Catalog - Schema & Module",
          "module": "business/master-catalog",
          "priority": "P1",
          "completion_criteria": [
            "MasterProduct model in Prisma schema",
            "MasterProductStatus enum (ACTIVE, DISCONTINUED, ARCHIVED)",
            "TenantProductAccess model with pricing fields",
            "MasterCatalogModule with service and controller",
            "CRUD endpoints: GET/POST/PATCH /master-catalog/products",
            "Admin-only access via CASL",
            "Unit tests: >80% coverage"
          ],
          "dependencies": [
            "PRD-018"
          ],
          "max_iterations": 10,
          "status": "pending"
        },
        {
          "id": "PRD-022a",
          "title": "Master Catalog - Admin Import",
          "module": "business/master-catalog",
          "priority": "P1",
          "completion_criteria": [
            "POST /admin/master-catalog/import endpoint",
            "JSON file upload with Multer",
            "Batch import (500 products/transaction)",
            "Import statistics returned",
            "Idempotent (skipDuplicates)",
            "Seed script for master catalog data",
            "Integration tests for import"
          ],
          "dependencies": [
            "PRD-022"
          ],
          "max_iterations": 8,
          "status": "pending"
        },
        {
          "id": "PRD-022b",
          "title": "Tenant Catalog - Access & Pricing",
          "module": "business/tenant-catalog",
          "priority": "P1",
          "completion_criteria": [
            "TenantCatalogModule with service and controller",
            "GET /catalog/products (tenant-scoped)",
            "GET /catalog/products/:id with tenant pricing",
            "POST /catalog/products/:id/access (grant access)",
            "PUT /catalog/products/:id/pricing (set pricing)",
            "Pricing hierarchy: agreedPrice > discountPercent > listPrice",
            "Support validity periods and quantity limits",
            "Unit and integration tests"
          ],
          "dependencies": [
            "PRD-022"
          ],
          "max_iterations": 10,
          "status": "pending"
        },
        {
          "id": "PRD-022c",
          "title": "Quote Integration - Master Catalog",
          "module": "business/quotes",
          "priority": "P1",
          "completion_criteria": [
            "CreateQuoteLineItemDto accepts masterProductId",
            "Auto-resolve product name, SKU, price from catalog",
            "Validate tenant has access to product",
            "Apply tenant-specific pricing",
            "Backward compatible (manual entry still works)",
            "Unit tests for pricing resolution"
          ],
          "dependencies": [
            "PRD-021",
            "PRD-022b"
          ],
          "max_iterations": 8,
          "status": "pending"
        },
        {
          "id": "PRD-023",
          "title": "Approvals Module",
          "module": "business/approvals",
          "priority": "P2",
          "completion_criteria": [
            "Approval chains",
            "Multi-level with delegation"
          ],
          "dependencies": [
            "PRD-020"
          ],
          "max_iterations": 12,
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-4",
      "name": "Platform Modules",
      "weight": "30% Lisa / 70% Ralph",
      "items": [
        {
          "id": "PRD-024",
          "title": "Notifications Module",
          "module": "platform/notifications",
          "priority": "P1",
          "completion_criteria": [
            "In-app notifications",
            "Email via BullMQ"
          ],
          "dependencies": [
            "PRD-018"
          ],
          "max_iterations": 8,
          "status": "pending"
        },
        {
          "id": "PRD-025",
          "title": "Files Module",
          "module": "platform/files",
          "priority": "P1",
          "completion_criteria": [
            "Upload to MinIO",
            "Signed URLs"
          ],
          "dependencies": [
            "PRD-005",
            "PRD-018"
          ],
          "max_iterations": 10,
          "status": "pending"
        },
        {
          "id": "PRD-026",
          "title": "Dashboard Module",
          "module": "platform/dashboard",
          "priority": "P2",
          "completion_criteria": [
            "GET /dashboard/kpis",
            "Redis caching"
          ],
          "dependencies": [
            "PRD-020",
            "PRD-021"
          ],
          "max_iterations": 8,
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-5",
      "name": "Agentic Layer",
      "weight": "60% Lisa / 40% Ralph",
      "items": [
        {
          "id": "PRD-027",
          "title": "Tool Registry",
          "module": "agentic/tools",
          "priority": "P2",
          "completion_criteria": [
            "@AgentTool() decorator",
            "GET /agent/tools"
          ],
          "dependencies": [
            "PRD-013"
          ],
          "max_iterations": 10,
          "status": "pending"
        },
        {
          "id": "PRD-028",
          "title": "Agent Orchestrator",
          "module": "agentic/orchestrator",
          "priority": "P2",
          "completion_criteria": [
            "POST /agent/execute",
            "Rate limiting"
          ],
          "dependencies": [
            "PRD-027"
          ],
          "max_iterations": 12,
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-6",
      "name": "E-Commerce & Orders",
      "weight": "50% Lisa / 50% Ralph",
      "items": [
        {
          "id": "PRD-029",
          "title": "Shopping Cart Module",
          "module": "business/cart",
          "priority": "P0",
          "completion_criteria": [
            "Cart entity with CartItem relation",
            "GET /api/v1/cart - Get current user cart",
            "POST /api/v1/cart/items - Add item to cart",
            "PATCH /api/v1/cart/items/:id - Update quantity",
            "DELETE /api/v1/cart/items/:id - Remove item",
            "DELETE /api/v1/cart - Clear cart",
            "POST /api/v1/cart/apply-coupon - Apply coupon code",
            "Cart scoped to user and tenant",
            "Real-time price calculation with discounts",
            "Unit tests with 80% coverage",
            "Integration tests for all endpoints"
          ],
          "dependencies": [
            "PRD-021"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-030",
          "title": "Orders Module",
          "module": "business/orders",
          "priority": "P0",
          "completion_criteria": [
            "Order entity with OrderItem, status enum",
            "POST /api/v1/orders - Create order from cart",
            "GET /api/v1/orders - List user orders with filters",
            "GET /api/v1/orders/:id - Order details",
            "GET /api/v1/orders/:id/tracking - Tracking info",
            "POST /api/v1/orders/:id/cancel - Cancel order",
            "GET /api/v1/orders/:id/invoice - Download invoice",
            "POST /api/v1/orders/:id/reorder - Add to cart",
            "Order number generation (ORD-YYYY-NNNNN)",
            "Status workflow: draft→pending→confirmed→processing→shipped→delivered",
            "Admin endpoints: GET/PATCH /admin/orders",
            "POST /api/v1/admin/orders/:id/refund",
            "Unit tests with 80% coverage",
            "Integration tests for all endpoints"
          ],
          "dependencies": [
            "PRD-029"
          ],
          "max_iterations": 15,
          "status": "pending"
        },
        {
          "id": "PRD-031",
          "title": "Payment & Delivery Module",
          "module": "business/payments",
          "priority": "P0",
          "completion_criteria": [
            "PaymentMethod entity",
            "DeliveryMethod entity",
            "UserAddress entity",
            "GET /api/v1/payment-methods - Available methods for user",
            "POST /api/v1/orders/:id/pay - Process payment",
            "GET /api/v1/users/me/payment-history",
            "GET /api/v1/delivery-methods - List delivery options",
            "GET /api/v1/users/me/addresses - User addresses",
            "POST /api/v1/users/me/addresses - Add address",
            "PATCH /api/v1/users/me/addresses/:id - Update",
            "DELETE /api/v1/users/me/addresses/:id - Delete",
            "Payment method availability by user type",
            "Unit tests with 80% coverage",
            "Integration tests for all endpoints"
          ],
          "dependencies": [
            "PRD-030"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-032",
          "title": "Salary Deduction Module",
          "module": "business/salary-deduction",
          "priority": "P0",
          "completion_criteria": [
            "SalaryDeduction entity with limits",
            "SalaryDeductionTransaction entity",
            "SalaryDeductionLimitRequest entity",
            "GET /api/v1/users/me/salary-deduction - Status and limits",
            "GET /api/v1/users/me/salary-deduction/history - Deduction history",
            "PATCH /api/v1/users/me/salary-deduction - Update preferences",
            "POST /api/v1/users/me/salary-deduction/limit-request",
            "Admin: GET /api/v1/admin/salary-deductions",
            "Admin: PATCH /api/v1/admin/salary-deductions/:userId",
            "Admin: GET /api/v1/admin/salary-deductions/report",
            "Admin: GET /api/v1/admin/salary-deductions/limit-requests",
            "Admin: POST .../limit-requests/:id/approve",
            "Admin: POST .../limit-requests/:id/reject",
            "Monthly limit enforcement",
            "Payroll export functionality",
            "Unit tests with 80% coverage",
            "Integration tests for all endpoints"
          ],
          "dependencies": [
            "PRD-031"
          ],
          "max_iterations": 14,
          "status": "pending"
        },
        {
          "id": "PRD-033",
          "title": "Discount Tiers Module",
          "module": "business/discounts",
          "priority": "P1",
          "completion_criteria": [
            "DiscountTier entity",
            "UserDiscountTier assignment entity",
            "GET /api/v1/users/me/discount-tier - User tier info",
            "GET /api/v1/users/me/savings - Savings stats",
            "Admin: GET /api/v1/admin/discount-tiers",
            "Admin: POST /api/v1/admin/discount-tiers",
            "Admin: PATCH /api/v1/admin/discount-tiers/:id",
            "Admin: DELETE /api/v1/admin/discount-tiers/:id",
            "Admin: POST /api/v1/admin/discount-tiers/:id/assign",
            "Tier levels: Bronze, Silver, Gold, Platinum",
            "Discount calculation in cart/orders",
            "Unit tests with 80% coverage",
            "Integration tests for all endpoints"
          ],
          "dependencies": [
            "PRD-029"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-034",
          "title": "Promotions & Coupons Module",
          "module": "business/promotions",
          "priority": "P2",
          "completion_criteria": [
            "Promotion entity with conditions",
            "Coupon entity",
            "GET /api/v1/promotions/available - For current user",
            "Admin: GET /api/v1/admin/promotions",
            "Admin: POST /api/v1/admin/promotions",
            "Admin: PATCH /api/v1/admin/promotions/:id",
            "Admin: GET /api/v1/admin/promotions/:id/analytics",
            "Admin: POST /api/v1/admin/coupons/generate",
            "Promotion types: percentage, fixed, BOGO",
            "Usage limits and tracking",
            "Date-based activation",
            "Unit tests with 80% coverage",
            "Integration tests for all endpoints"
          ],
          "dependencies": [
            "PRD-033"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-035",
          "title": "Partner Module",
          "module": "business/partners",
          "priority": "P1",
          "completion_criteria": [
            "Partner entity linked to Organization",
            "PartnerCommission entity",
            "PartnerResource entity",
            "GET /api/v1/partners/me - Partner profile",
            "GET /api/v1/partners/me/commission - Commission details",
            "GET /api/v1/partners/me/team - Team members",
            "GET /api/v1/partners/me/resources - Partner docs",
            "POST /api/v1/partners/me/team - Add team member",
            "DELETE /api/v1/partners/me/team/:userId",
            "POST /api/v1/orders/on-behalf - Order for team member",
            "Commission calculation on team orders",
            "Unit tests with 80% coverage",
            "Integration tests for all endpoints"
          ],
          "dependencies": [
            "PRD-030"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-036",
          "title": "Catalog Enhancements",
          "module": "business/catalog",
          "priority": "P1",
          "completion_criteria": [
            "Category entity with hierarchy",
            "GET /api/v1/catalog/categories - Category tree",
            "GET /api/v1/catalog/products/:id - Single product detail",
            "GET /api/v1/catalog/products/:id/related - Related products",
            "GET /api/v1/catalog/search/suggestions - Autocomplete",
            "Enhanced filters: categoryId, minPrice, maxPrice, availability",
            "Add discountedPrice to product response",
            "Add availability status to products",
            "Add primaryImage field",
            "Unit tests with 80% coverage",
            "Integration tests for all endpoints"
          ],
          "dependencies": [
            "PRD-021"
          ],
          "max_iterations": 10,
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-7",
      "name": "Integration Foundation",
      "items": [
        {
          "id": "PRD-040",
          "title": "Integration Hub Core",
          "module": "integrations/hub",
          "priority": "P0",
          "completion_criteria": [
            "IntegrationHub service with message routing",
            "IntegrationMessage model in Prisma schema",
            "Transformation pipeline (source → canonical → target)",
            "Retry policy with exponential backoff",
            "Dead-letter queue for failed messages",
            "Circuit breaker pattern implementation",
            "Idempotency handling with deduplication",
            "Rate limiting per connector",
            "Health check endpoints",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-041",
          "title": "Connector Registry & Plugin System",
          "module": "integrations/connectors",
          "priority": "P0",
          "completion_criteria": [
            "Connector and ConnectorConfig models in Prisma",
            "IConnector interface definition",
            "ConnectorRegistry service for plugin management",
            "Credential vault with encrypted storage",
            "Connector lifecycle (register, configure, enable, disable)",
            "Capability declaration system",
            "Dynamic connector loading",
            "Admin CRUD API for connectors",
            "Test connection endpoint",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-040"
          ],
          "max_iterations": 10,
          "status": "pending"
        },
        {
          "id": "PRD-042",
          "title": "Generic REST Connector",
          "module": "integrations/connectors/rest",
          "priority": "P0",
          "completion_criteria": [
            "Configurable REST client",
            "Auth support: Basic, Bearer, OAuth2, API Key",
            "Request/response mapping via JSONPath",
            "Configurable endpoints per operation",
            "Pagination handling (offset, cursor, link)",
            "Error mapping and handling",
            "Request/response logging",
            "Webhook receiver for callbacks",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-041"
          ],
          "max_iterations": 8,
          "status": "pending"
        },
        {
          "id": "PRD-043",
          "title": "Message Queue Integration",
          "module": "integrations/events",
          "priority": "P0",
          "completion_criteria": [
            "Event publisher service",
            "Event subscriber service",
            "BullMQ job queues for async processing",
            "Event types: ORDER_*, INVOICE_*, INVENTORY_*",
            "Event replay capability",
            "Event filtering by tenant/type",
            "Webhook delivery for external systems",
            "Event log with retention policy",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-040"
          ],
          "max_iterations": 10,
          "status": "pending"
        },
        {
          "id": "PRD-044",
          "title": "Integration Monitoring & Logging",
          "module": "integrations/monitoring",
          "priority": "P1",
          "completion_criteria": [
            "Integration dashboard KPIs endpoint",
            "Message throughput metrics",
            "Error rate tracking",
            "Latency percentiles (p50, p95, p99)",
            "Connector health status",
            "Alert configuration (thresholds)",
            "Audit log for all integration actions",
            "Log retention and archival",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-040",
            "PRD-041"
          ],
          "max_iterations": 8,
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-8",
      "name": "ERP Connectors",
      "items": [
        {
          "id": "PRD-045",
          "title": "SAP S/4HANA Connector",
          "module": "integrations/connectors/sap",
          "priority": "P1",
          "completion_criteria": [
            "SAP OData V4 client implementation",
            "OAuth2 authentication with SAP",
            "Sales Order creation (A_SalesOrder)",
            "Sales Order status retrieval",
            "Customer master sync (A_BusinessPartner)",
            "Product/Material sync (A_Product)",
            "Invoice retrieval",
            "Inventory check (ATP)",
            "Error handling for SAP-specific codes",
            "Mapping to canonical models",
            "Configuration UI schema",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-042"
          ],
          "max_iterations": 14,
          "status": "pending"
        },
        {
          "id": "PRD-046",
          "title": "Microsoft Dynamics 365 Connector",
          "module": "integrations/connectors/dynamics",
          "priority": "P1",
          "completion_criteria": [
            "Dynamics 365 Web API client",
            "Azure AD OAuth2 authentication",
            "Sales Order creation",
            "Sales Order status sync",
            "Customer/Account sync",
            "Product catalog sync",
            "Invoice retrieval",
            "Price list sync",
            "Mapping to canonical models",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-042"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-047",
          "title": "NetSuite Connector",
          "module": "integrations/connectors/netsuite",
          "priority": "P1",
          "completion_criteria": [
            "NetSuite REST/SuiteTalk client",
            "Token-based authentication (TBA)",
            "Sales Order creation",
            "Customer sync",
            "Item/Product sync",
            "Invoice sync",
            "Inventory check",
            "Saved search execution",
            "Mapping to canonical models",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-042"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-048",
          "title": "Oracle ERP Cloud Connector",
          "module": "integrations/connectors/oracle",
          "priority": "P2",
          "completion_criteria": [
            "Oracle REST API client",
            "OAuth2 authentication",
            "Sales Order creation",
            "Order status sync",
            "Customer sync",
            "Item master sync",
            "Invoice sync",
            "Mapping to canonical models",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-042"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-049",
          "title": "QuickBooks Connector",
          "module": "integrations/connectors/quickbooks",
          "priority": "P2",
          "completion_criteria": [
            "QuickBooks Online API client",
            "OAuth2 authentication",
            "Sales Receipt/Invoice creation",
            "Customer sync",
            "Item sync",
            "Payment sync",
            "Mapping to canonical models",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-042"
          ],
          "max_iterations": 8,
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-9",
      "name": "EDI & E-Invoicing",
      "items": [
        {
          "id": "PRD-050",
          "title": "EDI X12 Parser/Generator",
          "module": "integrations/edi/x12",
          "priority": "P1",
          "completion_criteria": [
            "X12 lexer/parser implementation",
            "X12 generator implementation",
            "Transaction sets: 850, 855, 856, 810, 997",
            "ISA/GS/ST envelope handling",
            "Segment/element validation",
            "Partner-specific delimiters",
            "Version support (4010, 5010)",
            "Mapping to/from canonical models",
            "Parse error reporting with location",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-040"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-051",
          "title": "EDIFACT Parser/Generator",
          "module": "integrations/edi/edifact",
          "priority": "P1",
          "completion_criteria": [
            "EDIFACT parser implementation",
            "EDIFACT generator implementation",
            "Message types: ORDERS, ORDRSP, DESADV, INVOIC",
            "UNB/UNH envelope handling",
            "Syntax version support (D96A, D01B)",
            "Mapping to/from canonical models",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-040"
          ],
          "max_iterations": 10,
          "status": "pending"
        },
        {
          "id": "PRD-052",
          "title": "AS2/SFTP Transport",
          "module": "integrations/edi/transport",
          "priority": "P1",
          "completion_criteria": [
            "AS2 client implementation",
            "AS2 server (receive) implementation",
            "MDN (receipt) handling",
            "Certificate management",
            "SFTP client for file exchange",
            "Partner trading profile configuration",
            "Inbound file polling",
            "Outbound file delivery",
            "Transport logging",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-050",
            "PRD-051"
          ],
          "max_iterations": 10,
          "status": "pending"
        },
        {
          "id": "PRD-053",
          "title": "E-Invoicing - Peppol (EU)",
          "module": "integrations/einvoice/peppol",
          "priority": "P1",
          "completion_criteria": [
            "UBL 2.1 Invoice generation",
            "UBL 2.1 Credit Note generation",
            "Peppol BIS Billing 3.0 compliance",
            "Schematron validation",
            "Participant lookup (SMP)",
            "Access Point API integration",
            "Document status tracking",
            "XRechnung extension (Germany)",
            "PDF/A-3 with embedded XML",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-040"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-054",
          "title": "E-Invoicing - CFDI 4.0 (Mexico)",
          "module": "integrations/einvoice/cfdi",
          "priority": "P1",
          "completion_criteria": [
            "CFDI 4.0 XML generation",
            "Digital signature with CSD",
            "PAC integration for timbrado",
            "UUID tracking",
            "Cancellation with motivo",
            "Pagos 2.0 complement",
            "Comercio Exterior complement",
            "SAT validation integration",
            "PDF representation",
            "Common addenda support",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-040"
          ],
          "max_iterations": 14,
          "status": "pending"
        },
        {
          "id": "PRD-055",
          "title": "E-Invoicing - NF-e (Brazil)",
          "module": "integrations/einvoice/nfe",
          "priority": "P2",
          "completion_criteria": [
            "NF-e XML generation (layout 4.0)",
            "Digital signature (A1/A3 certificate)",
            "SEFAZ webservice integration",
            "Authorization and status check",
            "Cancellation (Evento)",
            "Correction letter (CC-e)",
            "DANFE PDF generation",
            "Contingency modes",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-040"
          ],
          "max_iterations": 14,
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-10",
      "name": "Business Flows",
      "items": [
        {
          "id": "PRD-056",
          "title": "Order-to-Cash Flow",
          "module": "integrations/flows/o2c",
          "priority": "P0",
          "completion_criteria": [
            "Flow orchestration engine",
            "Order sync trigger on ORDER_CREATED",
            "Credit check step (real-time)",
            "Order status polling/webhook",
            "Shipment/ASN sync",
            "Invoice generation trigger",
            "Invoice sync back to B2B",
            "Payment status sync",
            "Flow configuration per tenant",
            "Flow execution logging",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-040",
            "PRD-041",
            "PRD-043"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-057",
          "title": "Procure-to-Pay Flow",
          "module": "integrations/flows/p2p",
          "priority": "P1",
          "completion_criteria": [
            "PO receipt from ERP",
            "PO acknowledgment generation",
            "Goods receipt sync",
            "Invoice submission to ERP",
            "3-way match support",
            "Payment status tracking",
            "Flow configuration per tenant",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-056"
          ],
          "max_iterations": 12,
          "status": "pending"
        },
        {
          "id": "PRD-058",
          "title": "Inventory/ATP Sync",
          "module": "integrations/flows/inventory",
          "priority": "P0",
          "completion_criteria": [
            "InventoryLevel model in Prisma",
            "InventoryReservation model",
            "Real-time stock check API",
            "Batch inventory sync job",
            "ATP calculation logic",
            "Multi-warehouse support",
            "Safety stock configuration",
            "Low stock alerts",
            "Reservation on checkout",
            "Reservation timeout/release",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-040",
            "PRD-043"
          ],
          "max_iterations": 10,
          "status": "pending"
        },
        {
          "id": "PRD-059",
          "title": "Price List Sync",
          "module": "integrations/flows/pricing",
          "priority": "P1",
          "completion_criteria": [
            "Price list import from ERP",
            "Customer-specific pricing",
            "Currency support",
            "Effective date handling",
            "Price override rules",
            "Batch sync job",
            "Delta sync support",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-040",
            "PRD-043"
          ],
          "max_iterations": 8,
          "status": "pending"
        },
        {
          "id": "PRD-060",
          "title": "Customer Master Sync",
          "module": "integrations/flows/customer",
          "priority": "P1",
          "completion_criteria": [
            "New customer push to ERP",
            "Customer update sync (bidirectional)",
            "Address sync",
            "Tax ID validation",
            "Credit limit sync from ERP",
            "Payment terms sync",
            "Customer hierarchy support",
            "Unit tests with 80%+ coverage"
          ],
          "api_dependencies": [],
          "dependencies": [
            "PRD-040",
            "PRD-043"
          ],
          "max_iterations": 8,
          "status": "pending"
        }
      ]
    }
  ],
  "metadata": {
    "total_items": 61,
    "estimated_iterations": 607,
    "completion_promise_format": "<promise>COMPLETE:PRD-XXX</promise>"
  }
}